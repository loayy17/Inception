# Docker vs virtual machine 
| #      | **Aspect**              | **Docker (Containers)**                               | **Virtual Machine (VM)**                      |
| ------ | ----------------------- | ----------------------------------------------------- | --------------------------------------------- |
| **1**  | **System Architecture** | Shares the **host OS kernel**                         | Each VM runs its **own full OS**              |
| **2**  | **Startup Speed**       | **Seconds** ‚Äî lightweight and fast                    | **Minutes** ‚Äî needs to boot full OS           |
| **3**  | **Resource Usage**      | **Low** ‚Äî no OS duplication                           | **High** ‚Äî each VM includes its own OS        |
| **4**  | **Performance**         | **Near-native** performance                           | **Slower** due to virtualization overhead     |
| **5**  | **Isolation Level**     | **Process-level isolation** (via namespaces, cgroups) | **Hardware-level isolation** (via hypervisor) |
| **6**  | **Image Size**          | Small (usually **MBs**)                               | Large (often **GBs**)                         |
| **7**  | **Portability**         | Highly **portable** across systems                    | Limited portability                           |
| **8**  | **Security**            | Weaker (shared kernel risk)                           | Stronger (independent OS)                     |
| **9**  | **Use Cases**           | Microservices, CI/CD, cloud-native apps               | Full OS environments, legacy systems          |
| **10** | **Examples**            | Docker, Podman, LXC                                   | VMware, VirtualBox, Hyper-V                   |

# Docker Commands
| **Category**              | **Command**                          | **Description / When Used in Inception**                                        |
| ------------------------- | ------------------------------------ | ------------------------------------------------------------------------------- |
| üèó **Images**             | `docker build -t <name> .`           | Build a custom image from your Dockerfile (e.g., NGINX, MariaDB, WordPress).    |
|                           | `docker images`                      | Show list of built images ‚Äî useful to verify builds.                            |
|                           | `docker rmi <image>`                 | Remove unused images to save space.                                             |
| üß∞ **Containers**         | `docker run -it <image>`             | Test-run an image interactively before using in Compose.                        |
|                           | `docker ps -a`                       | Show all containers (running + stopped). Used for debugging.                    |
|                           | `docker stop <container>`            | Stop a running service container.                                               |
|                           | `docker start <container>`           | Start a stopped container.                                                      |
|                           | `docker logs <container>`            | Check logs (especially for MariaDB, WordPress, NGINX errors).                   |
|                           | `docker exec -it <container> bash`   | Enter container shell for debugging or manual testing.                          |
|                           | `docker rm <container>`              | Remove a stopped container (cleanup).                                           |
| üåê **Networks & Volumes** | `docker network ls`                  | Verify the networks created by Docker Compose (e.g., internal communication).   |
|                           | `docker volume ls`                   | Check persistent volumes (`/home/loay/data/...`).                               |
|                           | `docker volume inspect <name>`       | Confirm mount points or paths.                                                  |
|                           | `docker volume rm <name>`            | Remove a volume (careful: deletes stored data).                                 |
| üß© **Docker Compose**     | `docker compose up --build`          | Build all images and start the full project stack.                              |
|                           | `docker compose up -d`               | Run all services in background (detached mode).                                 |
|                           | `docker compose down`                | Stop and remove all containers, networks, and volumes (except persistent ones). |
|                           | `docker compose ps`                  | Check which services (nginx, wordpress, mariadb) are running.                   |
|                           | `docker compose logs`                | View combined logs for all services.                                            |
|                           | `docker compose exec <service> bash` | Enter a service container to debug (e.g., `wordpress`, `mariadb`).              |
| üßπ **System Cleanup**     | `docker system prune`                | Clean up unused containers, images, and networks (safe for freeing space).      |
|                           | `docker volume prune`                | Remove unused volumes (after rebuilds).                                         |

# Docker files 
| **Command**       | **Description**                                                                                   | **Example**                                                     | 
| ----------------- | ------------------------------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **`FROM`**        | Sets the **base image** for building your image. Must be the first command.                       | `FROM debian:bullseye`                                          |
| **`RUN`**         | Executes a command **during build time** (creates a new image layer).                             | `RUN apt-get update && apt-get install -y nginx`                |
| **`CMD`**         | Defines the **default command** to run when the container starts (can be overridden).             | `CMD ["nginx", "-g", "daemon off;"]`                            |
| **`ENTRYPOINT`**  | Defines a **fixed executable** that always runs when the container starts (even with extra args). | `ENTRYPOINT ["bash", "/tools/entrypoint.sh"]`                   | 
| **`COPY`**        | Copies files/folders **from host to container**.                                                  | `COPY ./conf/nginx.conf /etc/nginx/conf.d/default.conf`         |
| **`ADD`**         | Similar to `COPY` but can also **extract archives or download URLs**.                             | `ADD ./tools/entrypoint.sh /tools/`                             | 
| **`WORKDIR`**     | Sets the **working directory** inside the container.                                              | `WORKDIR /var/www/html`                                         |
| **`EXPOSE`**      | Documents which **port** the container listens on (does not publish it).                          | `EXPOSE 80`                                                     |
| **`ENV`**         | Sets an **environment variable** inside the container.                                            | `ENV MYSQL_DATABASE=wordpress`                                  |
| **`VOLUME`**      | Defines a **mount point** for persistent data.                                                    | `VOLUME /var/lib/mysql`                                         |
| **`USER`**        | Sets which **user** runs commands and processes inside the container.                             | `USER www-data`                                                 |
| **`ARG`**         | Defines build-time variables (only available while building).                                     | `ARG DEBIAN_FRONTEND=noninteractive`                            |
| **`LABEL`**       | Adds metadata to the image.                                                                       | `LABEL maintainer="loay@42.fr"`                                 |

# Nginx 
| **Directive / Section**         | **Example / Code**                                    | **Purpose**                                                       | **Why / When It‚Äôs Used in Inception**                                 |
| ------------------------------- | ----------------------------------------------------- | ----------------------------------------------------------------- | --------------------------------------------------------------------- |
| **`server { ... }`**            | Whole block                                           | Defines a **virtual server** configuration in NGINX               | Each domain (like `loay.42.fr`) gets its own server block             |
| **`listen 443 ssl;`**           | `listen 443 ssl;`                                     | Tells NGINX to listen for HTTPS (SSL) connections on port **443** | HTTPS is mandatory in Inception ‚Äî must use SSL certificates           |
| **`server_name`**               | `server_name loay.42.fr;`                             | Specifies the domain name handled by this block                   | Matches the domain configured in `/etc/hosts`                         |
| **`ssl_certificate`**           | `/etc/nginx/ssl/ssl_certificate.crt`                  | Path to the SSL certificate file                                  | Used to encrypt communication (HTTPS)                                 |
| **`ssl_certificate_key`**       | `/etc/nginx/ssl/ssl_certificate.key`                  | Private key that matches the SSL certificate                      | Used to decrypt HTTPS requests                                        |
| **`ssl_protocols`**             | `TLSv1.2 TLSv1.3;`                                    | Restricts allowed SSL/TLS versions                                | Improves security by using modern protocols only                      |
| **`ssl_ciphers`**               | `HIGH:!aNULL:!MD5;`                                   | Defines which encryption ciphers to use                           | Ensures strong encryption and disables weak ciphers                   |
| **`root`**                      | `/var/www/html`                                       | Root directory of your website files                              | Points to where WordPress files are stored inside the container       |
| **`index`**                     | `index.php index.html;`                               | Defines the default file to serve                                 | Loads `index.php` (WordPress entry point) first                       |
| **`location / { ... }`**        | `try_files $uri $uri/ =404;`                          | Handles requests to the site root                                 | Tries to serve a file, or returns 404 if not found                    |
| **`location ~ \.php$ { ... }`** | PHP handling block                                    | Tells NGINX how to handle `.php` files                            | Sends PHP files to the PHP-FPM process in the **WordPress container** |
| **`include fastcgi_params;`**   | Inside PHP block                                      | Loads default FastCGI parameters                                  | Needed for PHP communication                                          |
| **`fastcgi_pass`**              | `fastcgi_pass wordpress:9000;`                        | Sends PHP requests to PHP-FPM at host `wordpress` port `9000`     | Connects NGINX container ‚Üí WordPress (PHP-FPM) container              |
| **`fastcgi_param`**             | `SCRIPT_FILENAME $document_root$fastcgi_script_name;` | Sets correct file path for PHP interpreter                        | Ensures WordPress executes the correct PHP file                       |

# mariadb 
| Line / Block                                                                                                                          | What it Does                                             | Why it‚Äôs Used (Inception / Docker)                                            |   |                                      |                                                           |                                                          |
| ------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------- | ----------------------------------------------------------------------------- | - | ------------------------------------ | --------------------------------------------------------- | -------------------------------------------------------- |
| `#!/bin/bash`                                                                                                                         | Shebang ‚Äî tells the system to run the script using Bash. | Ensures script executes correctly in container.                               |   |                                      |                                                           |                                                          |
| `if [ -z "${DATABASE_NAME}" ]                                                                                                         |                                                          | [ -z "${DATABASE_USER}" ]                                                     |   | [ -z "${DATABASE_PASSWORD}" ]; then` | Checks if **required environment variables** are missing. | Prevents starting MariaDB without essential credentials. |
| `echo "‚ùå ERROR: One or more required environment variables are not set."`                                                             | Prints error message.                                    | Helps debug missing variables during container startup.                       |   |                                      |                                                           |                                                          |
| `echo "DATABASE_NAME=${DATABASE_NAME}"`<br>`echo "DATABASE_USER=${DATABASE_USER}"`<br>`echo "DATABASE_PASSWORD=${DATABASE_PASSWORD}"` | Prints which variables are missing or empty.             | Debugging aid for environment configuration.                                  |   |                                      |                                                           |                                                          |
| `exit 1`                                                                                                                              | Stops script immediately if variables are missing.       | Prevents running MariaDB without proper setup.                                |   |                                      |                                                           |                                                          |
| `echo "‚úÖ Starting MariaDB service..."`                                                                                                | Status message.                                          | Logs progress for clarity.                                                    |   |                                      |                                                           |                                                          |
| `service mariadb start`                                                                                                               | Starts MariaDB temporarily.                              | Needed to run initialization SQL commands.                                    |   |                                      |                                                           |                                                          |
| `echo "‚è≥ Waiting for MariaDB to start..."`                                                                                            | Status message.                                          | Logs waiting status for readiness check.                                      |   |                                      |                                                           |                                                          |
| `until mariadb -e "SELECT 1" &>/dev/null; do sleep 1; done`                                                                           | Waits until MariaDB accepts connections.                 | Ensures DB is ready before running setup commands.                            |   |                                      |                                                           |                                                          |
| `echo "‚úÖ MariaDB is ready."`                                                                                                          | Confirmation message.                                    | Shows DB is ready for initialization.                                         |   |                                      |                                                           |                                                          |
| `echo "üîß Setting up database and user..."`                                                                                           | Status message.                                          | Indicates setup process starts.                                               |   |                                      |                                                           |                                                          |
| `mariadb -e "CREATE DATABASE IF NOT EXISTS \`${DATABASE_NAME}`;‚Äù`                                                                     | Creates the database if it does not exist.               | Ensures WordPress has a database to connect to.                               |   |                                      |                                                           |                                                          |
| `mariadb -e "CREATE USER IF NOT EXISTS '${DATABASE_USER}'@'%' IDENTIFIED BY '${DATABASE_PASSWORD}';"`                                 | Creates database user accessible from any host.          | Allows WordPress container to connect remotely.                               |   |                                      |                                                           |                                                          |
| `mariadb -e "GRANT ALL PRIVILEGES ON \`${DATABASE_NAME}`.* TO '${DATABASE_USER}'@'%';"`                                               | Grants full permissions to the user on the database.     | Ensures WordPress can read/write data.                                        |   |                                      |                                                           |                                                          |
| `mariadb -e "FLUSH PRIVILEGES;"`                                                                                                      | Reloads privileges in MariaDB.                           | Applies new user permissions immediately.                                     |   |                                      |                                                           |                                                          |
| `echo "‚úÖ Database and user setup complete."`                                                                                          | Status message.                                          | Confirms initialization finished.                                             |   |                                      |                                                           |                                                          |
| `echo "üõë Shutting down temporary MariaDB..."`                                                                                        | Status message.                                          | Indicates temporary DB instance will stop.                                    |   |                                      |                                                           |                                                          |
| `mysqladmin -uroot shutdown`                                                                                                          | Shuts down the temporary MariaDB service.                | Cleans up temporary process before running main DB.                           |   |                                      |                                                           |                                                          |
| `sleep 2`                                                                                                                             | Waits 2 seconds.                                         | Ensures shutdown completes before starting main service.                      |   |                                      |                                                           |                                                          |
| `echo "üöÄ Starting MariaDB on 0.0.0.0:3306"`                                                                                          | Status message.                                          | Logs main container DB start.                                                 |   |                                      |                                                           |                                                          |
| `exec mysqld_safe --bind-address=0.0.0.0 --port=3306`                                                                                 | Starts MariaDB in the foreground on all interfaces.      | Allows Docker to manage the process and expose port 3306 to other containers. |   |                                      |                                                           |                                                          |

# wordpess CLI
| Line / Block                                                                                                                                                                | What it Does                                                              | Why it‚Äôs Used (Inception / Docker)                               |                                                              |                                             |                                          |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- | ---------------------------------------------------------------- | 
| `#!/usr/bin/env bash`                                                                                                                                                       | Shebang ‚Äî runs the script using Bash from environment.                    | Ensures compatibility in container environments.                 |                                                              |                                             |                                          |
| `curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar`                                                                                         | Downloads the **WP-CLI tool** (PHP command-line interface for WordPress). | Needed to automate WordPress setup.                              |                                                              |                                             |                                          |
| `chmod +x wp-cli.phar`                                                                                                                                                      | Makes the WP-CLI file executable.                                         | Allows running `wp` commands.                                    |                                                              |                                             |                                          |
| `mv wp-cli.phar /usr/local/bin/wp`                                                                                                                                          | Moves WP-CLI to a directory in `$PATH` as `wp`.                           | Lets you call `wp` from anywhere.                                |                                                              |                                             |                                          |
| `WP_SRC_DIR="/var/www/html"`                                                                                                                                                | Sets a variable for the WordPress source directory.                       | Centralizes file path for reuse.                                 | 
| `cd $WP_SRC_DIR && chmod -R 755 $WP_SRC_DIR`                                                                                                                                | Navigates to the WordPress directory and sets permissions.                | Ensures files are readable/executable by web server.             |
| `sed -i 's                                                                                                                                                                  | ^listen = .*                                                              | listen = 9000                                                    | 
| `wp core download --allow-root`                                                                                                                                             | Downloads the latest WordPress core files.                                | Installs WordPress in `$WP_SRC_DIR`.                             | 
| `wp config create --dbname=${DATABASE_NAME} --dbuser=${DATABASE_USER} --dbpass=${DATABASE_PASSWORD} --dbhost=${DATABASE_HOST} --allow-root`                                 | Creates `wp-config.php` with DB credentials.                              | Connects WordPress to MariaDB.                                   |                                                              |                                             |                                          |
| `wp core install --url=${DOMAIN_NAME} --title=${WP_TITLE} --admin_user=${WP_ADMIN_USER} --admin_password=${WP_ADMIN_PASSWORD} --admin_email=${WP_ADMIN_EMAIL} --allow-root` | Installs WordPress and sets up the admin account.                         | Initializes the site for first use.                              |                                                              |                                             |                                          |
| `wp user create ${WP_USER} ${WP_USER_EMAIL} --user_pass=${WP_PASSWORD} --role=${WP_USER_ROLE} --allow-root`                                                                 | Creates an additional WordPress user.                                     | For non-admin accounts or testing.                               |                                                              |                                             |                                          |
| `wp theme install twentytwentyfive --activate --allow-root`                                                                                                                 | Installs and activates a WordPress theme.                                 | Provides default styling/layout.                                 |                                                              |                                             |                                          |
| `wp plugin install redis-cache --activate --allow-root`                                                                                                                     | Installs and activates Redis caching plugin.                              | Improves site performance in Docker environment.                 |                                                              |                                             |                                          |
| `wp redis enable --allow-root`                                                                                                                                              | Enables Redis caching in WordPress.                                       | Activates plugin features for caching.                           |                                                              |                                             |                                          |
| `wp page create "Home" --post_type=page --post_status=publish --allow-root`                                                                                                 | Creates a ‚ÄúHome‚Äù page.                                                    | Sets up the front page content.                                  |                                                              |                                             |                                          |
| `wp option set show_on_front 'page' --allow-root`                                                                                                                           | Configures WordPress to show a **static page** on front.                  | Makes ‚ÄúHome‚Äù page the front page.                                |                                                              |                                             |                                          |
| `wp option set page_on_front 2 --allow-root`                                                                                                                                | Sets the page with ID 2 as the front page.                                | Links the front page to the ‚ÄúHome‚Äù page created earlier.         |                                                              |                                             |                                          |
| `chown -R www-data:www-data $WP_SRC_DIR`                                                                                                                                    | Changes ownership of WordPress files to web server user.                  | Ensures NGINX/PHP-FPM can read/write files.                      |                                                              |                                             |                                          |
| `mkdir -p /run/php`                                                                                                                                                         | Creates runtime directory for PHP-FPM.                                    | Required for PHP-FPM to create sockets and PID files.            |                                                              |                                             |                                          |
| `php-fpm7.4 -F`                                                                                                                                                             | Starts PHP-FPM **in the foreground**.                                     | Keeps the container running and handles PHP requests from NGINX. |                                                              |                                             |                                          |
